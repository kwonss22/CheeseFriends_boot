<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="mul.cam.a.dao.UserDao">

<select id="idcheck" parameterType="String" resultType="String">
	SELECT ID
	FROM USER
	WHERE ID=#{id}
</select>

<select id="subjectlist" parameterType="String" resultType="mul.cam.a.dto.TestEduDto">
	select sub_name, sub_code, edu_code
	from subject
	where edu_code=#{edu_code}
</select>

<select id="eduname" parameterType="String" resultType="String">
	select edu_name
	from education
	where edu_code=#{edu_code}
</select>

<select id="subname" parameterType="String" resultType="String">
	select sub_name
	from subject
	where sub_code=#{sub_code}
</select>

<insert id="adduser" parameterType="mul.cam.a.dto.UserDto">
	insert into user(id, password, name, gender, email, birth, address, facename, newfacename, phone, phone_public, jointype, auth, breakaway, regidate)
	values(#{id}, #{password}, #{name}, #{gender}, #{email}, #{birth}, #{address}, #{facename}, '0', #{phone}, '0', 'cheesefriends', #{auth}, '0', now())
</insert>

<insert id="addusersubject" parameterType="mul.cam.a.dto.TestEduDto">
	insert into usersubject(user_id, sub_code, start_date, end_date)
	values(#{id}, #{subcode}, now(), now())
</insert> 

<select id="idmatching" parameterType="String" resultType="mul.cam.a.dto.UserDto">
	select id, name, auth
	from user
	where id=#{studentid}
</select>

<insert id="adduserparents" parameterType="mul.cam.a.dto.UserparentsDto">
	insert into userparents(studentid, parentsid)
	values(#{studentid}, #{parentsid})
</insert>

<select id="edusearch" parameterType="String" resultType="mul.cam.a.dto.EducationDto">
	select edu_code, edu_name
	from education
	where edu_name like concat('%', #{edu_name}, '%')
</select>

<insert id="adduseredu" parameterType="mul.cam.a.dto.TestEduDto">
	insert into useredu(user_id, edu_code)
	values(#{id}, #{educode})
</insert>

<select id="idsearch" parameterType="mul.cam.a.dto.UserDto" resultType="mul.cam.a.dto.UserDto">
	SELECT ID, regidate
	FROM USER
	WHERE name=#{name}
	and phone=#{phone}
</select>

<select id="idchecktwo" parameterType="mul.cam.a.dto.UserDto"  resultType="String">
	SELECT ID
	FROM USER
	WHERE ID=#{id}
	and phone=#{phone}
</select>

<update id="updatepassword" parameterType="mul.cam.a.dto.UserDto">
	update user
	set password=#{password}
	where id=#{id}
</update>

<select id="login" parameterType="mul.cam.a.dto.UserDto" resultType="mul.cam.a.dto.UserDto">
	select id, password, name, gender, email, birth, address, facename, newfacename, phone, phone_public, jointype, auth, breakaway, regidate
	from user
	where id=#{id} and password=#{password}
</select>

<update id="changeuser" parameterType="mul.cam.a.dto.UserDto">
	update user
	set password=#{password}, name=#{name}, gender=#{gender}, email=#{email}, address=#{address}, 
		facename=#{facename}, phone=#{phone}
	where id=#{id}
</update>


</mapper>