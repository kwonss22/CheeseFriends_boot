<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="AttManage">
<select id="getAttendanceList" resultMap="attendanceResultMap">
    SELECT attendanceTime, status FROM attendance
    WHERE studentID = #{studentID}
    AND sub_code = #{subCode}
    AND edu_code = #{eduCode}
</select>

  <resultMap id="attendanceResultMap" type="mul.cam.a.dto.CFR_Attendance">
    <result column="attendanceTime" property="attendanceTime"/>
    <result column="status" property="status"/>
  </resultMap>

 <resultMap id="subjectResultMap" type="mul.cam.a.dto.SubjectDto">
        <result property="subCode" column="sub_code"/>
        <result property="subName" column="sub_name"/>
    </resultMap>

    <select id="getSubjectsByUserId" resultMap="subjectResultMap" parameterType="string">
		SELECT s.sub_code, s.sub_name, s.edu_code
        FROM usersubject us
        JOIN subject s ON us.sub_code = s.sub_code
        WHERE us.user_id = #{userId}
    </select>
    
<resultMap id="attendanceMap" type="mul.cam.a.dto.CFR_Attendance">
  <id column="attendanceID" property="attendanceID"/>
  <result column="studentID" property="studentID"/>
  <result column="name" property="name"/>
  <result column="sub_code" property="subCode"/>
  <result column="attendanceTime" property="attendanceTime"/>
  <result column="status" property="status"/>
  <result column="edu_code" property="eduCode"/>
  <result column="comment" property="comment"/>
</resultMap>

<select id="getAttendanceBySubjectCode" resultMap="attendanceMap">
  select a.*, u.name
  from attendance a
  inner join user u on a.studentID = u.id
  where a.sub_code = #{subCode}
</select>

<update id="updateAttendanceStatus" parameterType="java.util.Map">
  UPDATE attendance SET status = #{status} WHERE attendanceID = #{attendanceID}
</update>

<update id="updateAttendancecomment" parameterType="java.util.Map">
    UPDATE attendance SET comment = #{comment} WHERE attendanceID = #{attendanceID}
</update>
  
</mapper>