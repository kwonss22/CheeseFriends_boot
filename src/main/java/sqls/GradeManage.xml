<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="mul.cam.a.dao.GradeManageDao">
	<!-- 교사가 담당하는 과목 목록 -->
	<select id="subTeacherlist" parameterType="String" resultType="mul.cam.a.dto.SubjectDto">
		SELECT *
		FROM SUBJECT
		WHERE EDUCATOR_NAME=#{educatorName}
		ORDER BY SUB_NAME ASC;
	</select>
	
	<!-- 과목을 듣는 학생 데이터 -->
	<select id="subStudentList" parameterType="mul.cam.a.dto.SubjectDto" resultType="mul.cam.a.dto.GradeDto">
		SELECT  S.SUB_CODE, S.EDU_CODE, 
				S.SUB_NAME, S.CLASS_GRADE,
				US.USER_ID, I.NAME
		FROM
		SUBJECT S INNER JOIN USERSUBJECT US
			ON S.SUB_CODE = US.SUB_CODE
			 INNER JOIN USER I
			 	ON US.USER_ID = I.ID
		WHERE S.EDUCATOR_NAME=#{educatorName} AND US.SUB_CODE=#{subCode}
	</select>
	<!-- 학생성적입력 -->
	<insert id="gradeAdd" parameterType="mul.cam.a.dto.GradeDto">
		INSERT INTO GRADE (SUB_CODE, EDU_CODE, SUB_NAME, CLASS_GRADE, STUDENT_ID, STUDENT_GRADE, STUDENT_RANKS, SUB_TOTAL)
		VALUES (#{subCode}, #{eduCode}, #{subName}, #{subName}, #{classGrade}, #{userId}, #{studentGrade}, 
		(SELECT COUNT(*) + 1 FROM GRADE WHERE SUB_CODE = #{subCode} AND STUDENT_GRADE > #{studentGrade}), 
		(SELECT IFNULL(COUNT(*), 0) FROM USERSUBJECT WHERE SUB_CODE = #{subCode}));
	</insert>
</mapper>